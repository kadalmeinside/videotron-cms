import{j as X,i as b,r as h,x as Y,k as L,y as Z,f as n,o as d,a as o,u as a,g as ee,w as m,b as s,h as p,c as F,p as se,F as U,l as P,t as g,v as te,e as v,S as re,n as N,d as ae,W as C}from"./app-1Y8zgK_u.js";import{A as oe}from"./AuthenticatedLayout-C3U01NLj.js";import{_ as q}from"./PrimaryButton-qr8OK47F.js";import{_ as j}from"./SecondaryButton-BzBKOSNX.js";import{_ as B,D as le}from"./Modal-BfnrhBMy.js";import{_ as S}from"./InputError-DElB5cka.js";import{_ as V}from"./InputLabel-C134EFyr.js";import{_ as M}from"./TextInput-C6vV7-lH.js";import{_ as de}from"./Checkbox-DXPGrYZd.js";import{_ as ne}from"./Toast-NILzICf9.js";import{l as ie}from"./lodash-D_sEwA76.js";import{r as ue}from"./PlusIcon-6rUJEBYi.js";import{r as me,a as ce}from"./TrashIcon-Db5FgZWt.js";import"./XMarkIcon-CHTrPqRh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ExclamationTriangleIcon--pKVNfcl.js";const pe={class:"pb-12 pt-4"},ge={class:"max-w-7xl mx-auto"},fe={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},xe={class:"p-6 text-gray-900 dark:text-gray-100"},ve={class:"mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4"},ye={class:"flex flex-col sm:flex-row items-center gap-3 flex-grow"},_e=["value"],we={class:"overflow-x-auto"},ke={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},be={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},he={key:0},Ue={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300"},Se={class:"px-6 py-4 whitespace-nowrap text-sm"},Ve={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},Me={key:1,class:"text-xs text-gray-400"},Ee={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Re=["onClick"],$e=["onClick"],De={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-700"},Pe={class:"flex flex-wrap -mb-1 justify-center"},Te=["innerHTML"],Ae={class:"p-6"},Le={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4 border-b pb-3 dark:border-gray-700"},Ne={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Fe={key:0},qe={key:1},je={class:"mt-2 grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2 max-h-32 overflow-y-auto p-2 border dark:border-gray-700 rounded-md"},Be={class:"text-sm text-gray-700 dark:text-gray-300"},He={class:"mt-6 flex justify-end space-x-3 pt-4 border-t dark:border-gray-700"},We={class:"p-6"},Oe={class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},Ie={class:"font-semibold"},ze={class:"mt-6 flex justify-end space-x-3"},us={__name:"Index",setup(Ge){const f=X(),u=b(()=>f.props.users),E=b(()=>f.props.filters||{}),R=b(()=>f.props.allRoles||[]),T=b(()=>f.props.can||{}),H=b(()=>{var l;return(l=f.props.flash)==null?void 0:l.message}),W=b(()=>{var l;return((l=f.props.flash)==null?void 0:l.type)||"info"}),$=h(!1),i=h(!1),r=Y({id:null,name:"",email:"",password:"",password_confirmation:"",roles:[]}),y=h(E.value.search||""),_=h(E.value.role||""),O=()=>{console.log("Applying filters:",{search:y.value,role:_.value}),C.get(route("admin.users.index"),{search:y.value,role:_.value,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})};L([y,_],ie.debounce(O,300));const I=()=>{i.value=!1,r.reset(),r.clearErrors(),$.value=!0},z=l=>{i.value=!0,r.reset(),r.clearErrors(),r.id=l.id,r.name=l.name,r.email=l.email,r.password="",r.password_confirmation="",r.roles=l.roles_array?[...l.roles_array]:[],$.value=!0},A=()=>{$.value=!1,r.reset(),r.clearErrors()},G=()=>{const l=i.value?route("admin.users.update",r.id):route("admin.users.store"),e=i.value?"put":"post";r.submit(e,l,{preserveScroll:!0,onSuccess:()=>{A(),console.log("Form submitted successfully. Reloading page props...")},onError:x=>{console.error("Form submission error:",x)}})},w=h(!1),k=h(null),Q=l=>{k.value=l,w.value=!0},J=()=>{k.value&&C.delete(route("admin.users.destroy",k.value.id),{preserveScroll:!0,onSuccess:()=>{k.value=null,w.value=!1,console.log("User deleted successfully. Reloading page props..."),C.reload({preserveScroll:!0})},onError:l=>{console.error("Delete error:",l),k.value=null,w.value=!1}})};return Z(()=>{var e,x;const l=new URLSearchParams(window.location.search);y.value=l.get("search")||E.value.search||"",_.value=l.get("role")||E.value.role||"",console.log("Mounted. Initial Users:",(x=(e=u.value)==null?void 0:e.data)==null?void 0:x.length)}),L(()=>f.props.users,l=>{console.log("PAGE.PROPS.USERS (prop) changed:",l)},{deep:!0}),L(u,l=>{console.log("COMPUTED USERS changed:",l)},{deep:!0}),(l,e)=>(d(),n(U,null,[o(a(ee),{title:"Manage Users"}),o(oe,null,{header:m(()=>e[9]||(e[9]=[s("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"User Management",-1)])),default:m(()=>{var x;return[o(ne,{message:H.value,type:W.value},null,8,["message","type"]),s("div",pe,[s("div",ge,[s("div",fe,[s("div",xe,[s("div",ve,[s("div",ye,[o(M,{type:"text",modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"Search name or email...",class:"w-full sm:w-auto md:flex-grow lg:max-w-xs","aria-label":"Search users"},null,8,["modelValue"]),se(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),class:"w-full sm:w-auto md:flex-grow lg:max-w-xs border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm","aria-label":"Filter by role"},[e[10]||(e[10]=s("option",{value:""},"All Roles",-1)),(d(!0),n(U,null,P(R.value,t=>(d(),n("option",{key:t,value:t},g(t),9,_e))),128))],512),[[te,_.value]])]),(x=T.value)!=null&&x.create_user?(d(),F(q,{key:0,onClick:I,class:"w-full md:w-auto mt-2 md:mt-0"},{default:m(()=>[o(a(ue),{class:"-ml-0.5 mr-1.5 h-5 w-5","aria-hidden":"true"}),e[11]||(e[11]=v(" Add New User "))]),_:1})):p("",!0)]),s("div",we,[s("table",ke,[e[13]||(e[13]=s("thead",{class:"bg-gray-50 dark:bg-gray-700"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Name"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Email"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Roles"),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",be,[!u.value||!u.value.data||u.value.data.length===0?(d(),n("tr",he,e[12]||(e[12]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400"},"No users found.",-1)]))):p("",!0),(d(!0),n(U,null,P(u.value.data,t=>{var c,D;return d(),n("tr",{key:t.id},[s("td",Ue,g(t.name),1),s("td",Ce,g(t.email),1),s("td",Se,[t.roles_string&&t.roles_string.length>0?(d(),n("span",Ve,g(t.roles_string),1)):(d(),n("span",Me,"No Roles"))]),s("td",Ee,[(c=T.value)!=null&&c.edit_user?(d(),n("button",{key:0,onClick:K=>z(t),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 p-1 mr-2",title:"Edit User"},[o(a(me),{class:"h-5 w-5"})],8,Re)):p("",!0),(D=T.value)!=null&&D.delete_user?(d(),n("button",{key:1,onClick:K=>Q(t),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 p-1",title:"Delete User"},[o(a(ce),{class:"h-5 w-5"})],8,$e)):p("",!0)])])}),128))])])]),u.value&&u.value.links&&u.value.links.length>3?(d(),n("div",De,[s("div",Pe,[(d(!0),n(U,null,P(u.value.links,(t,c)=>(d(),n(U,{key:c},[t.url===null?(d(),n("div",{key:0,class:"mr-1 mb-1 px-3 py-2 text-sm leading-4 text-gray-400 dark:text-gray-500 border rounded dark:border-gray-600 select-none",innerHTML:t.label},null,8,Te)):(d(),F(a(re),{key:1,class:N(["mr-1 mb-1 px-3 py-2 text-sm leading-4 border rounded dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:border-indigo-500 dark:focus:border-indigo-700 focus:text-indigo-500 dark:focus:text-indigo-300",{"bg-indigo-500 text-white dark:bg-indigo-600 dark:text-white dark:border-indigo-700":t.active}]),href:t.url,innerHTML:t.label,"preserve-scroll":""},null,8,["class","href","innerHTML"]))],64))),128))])])):p("",!0)])])])]),o(B,{show:$.value,onClose:A,maxWidth:"2xl"},{default:m(()=>[s("div",Ae,[s("h2",Le,g(i.value?"Edit User":"Create New User"),1),s("form",{onSubmit:ae(G,["prevent"]),class:"space-y-6"},[s("div",null,[o(V,{for:"name_modal_user_form",value:"Name"}),o(M,{id:"name_modal_user_form",type:"text",class:"mt-1 block w-full",modelValue:a(r).name,"onUpdate:modelValue":e[2]||(e[2]=t=>a(r).name=t),required:"",autofocus:"",autocomplete:"name"},null,8,["modelValue"]),o(S,{class:"mt-2",message:a(r).errors.name},null,8,["message"])]),s("div",null,[o(V,{for:"email_modal_user_form",value:"Email"}),o(M,{id:"email_modal_user_form",type:"email",class:"mt-1 block w-full",modelValue:a(r).email,"onUpdate:modelValue":e[3]||(e[3]=t=>a(r).email=t),required:"",autocomplete:"email"},null,8,["modelValue"]),o(S,{class:"mt-2",message:a(r).errors.email},null,8,["message"])]),s("div",null,[o(V,{for:"password_modal_user_form",value:i.value?"New Password (Optional)":"Password"},null,8,["value"]),o(M,{id:"password_modal_user_form",type:"password",class:"mt-1 block w-full",modelValue:a(r).password,"onUpdate:modelValue":e[4]||(e[4]=t=>a(r).password=t),required:!i.value,autocomplete:"new-password"},null,8,["modelValue","required"]),o(S,{class:"mt-2",message:a(r).errors.password},null,8,["message"]),i.value&&!a(r).password?(d(),n("p",Ne,"Leave blank to keep current password.")):p("",!0)]),a(r).password||!i.value?(d(),n("div",Fe,[o(V,{for:"password_confirmation_modal_user_form",value:"Confirm Password"}),o(M,{id:"password_confirmation_modal_user_form",type:"password",class:"mt-1 block w-full",modelValue:a(r).password_confirmation,"onUpdate:modelValue":e[5]||(e[5]=t=>a(r).password_confirmation=t),required:a(r).password!==""||!i.value,autocomplete:"new-password"},null,8,["modelValue","required"]),o(S,{class:"mt-2",message:a(r).errors.password_confirmation},null,8,["message"])])):p("",!0),R.value&&R.value.length>0?(d(),n("div",qe,[o(V,{value:"Roles",class:"mb-1"}),s("div",je,[(d(!0),n(U,null,P(R.value,(t,c)=>(d(),n("label",{key:"role_option_"+c,class:"flex items-center space-x-2 cursor-pointer"},[o(de,{id:"role_modal_user_form_"+c,value:t,checked:a(r).roles,"onUpdate:checked":e[6]||(e[6]=D=>a(r).roles=D)},null,8,["id","value","checked"]),s("span",Be,g(t),1)]))),128))]),o(S,{class:"mt-2",message:a(r).errors.roles},null,8,["message"])])):p("",!0),s("div",He,[o(j,{onClick:A,type:"button"},{default:m(()=>e[14]||(e[14]=[v(" Cancel ")])),_:1}),o(q,{class:N({"opacity-25":a(r).processing}),disabled:a(r).processing},{default:m(()=>[v(g(i.value?"Update User":"Create User"),1)]),_:1},8,["class","disabled"])])],32)])]),_:1},8,["show"]),o(B,{show:w.value,onClose:e[8]||(e[8]=t=>w.value=!1),maxWidth:"md"},{default:m(()=>{var t;return[s("div",We,[e[19]||(e[19]=s("h2",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," Confirm Delete User ",-1)),s("p",Oe,[e[15]||(e[15]=v(' Are you sure you want to delete user "')),s("span",Ie,g((t=k.value)==null?void 0:t.name),1),e[16]||(e[16]=v('"? This action cannot be undone. '))]),s("div",ze,[o(j,{onClick:e[7]||(e[7]=c=>w.value=!1),type:"button"},{default:m(()=>e[17]||(e[17]=[v(" Cancel ")])),_:1}),o(le,{onClick:J,class:N({"opacity-25":a(C).processing||a(r).processing}),disabled:a(C).processing||a(r).processing},{default:m(()=>e[18]||(e[18]=[v(" Delete User ")])),_:1},8,["class","disabled"])])])]}),_:1},8,["show"])]}),_:1})],64))}};export{us as default};
