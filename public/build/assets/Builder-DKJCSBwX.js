import{f as n,o as d,b as t,r as f,x as W,i as K,a as l,u as o,g as ne,w as p,F as k,l as b,n as A,t as i,e as c,d as ie,h as $,p as E,v as H,c as ue,S as ce,W as M,A as J}from"./app-BLeNn4LO.js";import{d as me,A as ge}from"./AuthenticatedLayout-HllnW7fv.js";import{_ as Y,D as pe}from"./Modal-xru5_Yyr.js";import{_ as L}from"./InputLabel-CgxTHTmz.js";import{_ as P}from"./PrimaryButton-6Sj3evt6.js";import{_ as z}from"./SecondaryButton-DvDU7CXS.js";import{_ as he}from"./Toast-k947icgK.js";import{_ as ye}from"./TextInput-DSC7ne63.js";import{r as G}from"./PlusIcon-Byr332_z.js";import{r as ve}from"./PencilIcon-Clud_zY2.js";import{r as fe}from"./TrashIcon-Cw9W7Szs.js";import"./XMarkIcon-CnMNgzJZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ExclamationTriangleIcon-Dbmr1S3L.js";function _e(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function xe(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function ke(v,h){return d(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z"})])}const we={class:"flex items-center"},be={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Se={class:"text-[--color-primary-600]"},De={class:"pb-12 pt-4"},Ce={class:"max-w-full mx-auto"},$e={class:"mb-6 bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm flex items-center gap-2"},Me={class:"flex-grow grid grid-cols-7 md:grid-cols-14 gap-1"},je=["onClick"],Ie={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},Te={key:0,class:"p-6"},Ve={class:"flex justify-between items-center border-b pb-2 mb-4"},Be={class:"text-lg font-medium text-gray-900 dark:text-white"},Ae={class:"flex items-center gap-x-4"},Ee={class:"space-y-3"},He={class:"flex items-center gap-4"},Je={class:"font-mono text-lg text-[--color-primary-600] dark:text-[--color-primary-400]"},Le={class:"font-medium text-gray-800 dark:text-gray-200"},Pe={class:"text-xs text-gray-500"},Fe=["onClick"],qe=["onClick"],Ne={key:1,class:"text-center p-12"},Oe={class:"mt-1 text-sm text-gray-500"},Ue={class:"mt-6"},We={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},Ke={class:"text-sm text-gray-500"},Ye={class:"mt-6 space-y-4"},ze={class:"flex items-center gap-2 mt-1"},Ge=["value"],Ze=["value"],Qe={key:0,class:"text-sm text-red-600 dark:text-red-400 mt-2"},Re=["value"],Xe={key:0,class:"text-sm text-red-600 dark:text-red-400 mt-2"},et={class:"mt-6 flex justify-between"},tt={class:"flex justify-end gap-x-2"},at={class:"p-6"},st={class:"text-sm text-gray-500 mt-1"},rt={class:"mt-6"},ot={key:0,class:"mt-4 p-3 bg-red-100 border border-red-200 text-red-800 rounded-md text-sm"},lt={class:"mt-6 flex justify-end gap-x-2"},Z=14,kt={__name:"Builder",props:{schedule:Object,scheduledDays:Object,allScheduledDates:Array,allMedia:Array,startDate:String},setup(v){const h=v,S=f(!1),_=f(!1),x=f({message:"",type:"info",show:!1}),y=f(h.startDate),D=f(new Date(h.startDate+"T00:00:00")),j=f(!1),I=f(null),s=W({id:null,schedule_date:"",play_hour:"07",play_minute:"00",media_id:""}),u=W({target_date:"",error:null}),T=K(()=>{const r=[],e=new Date(D.value);for(let m=0;m<Z;m++){const g=new Date(e);g.setDate(e.getDate()+m);const a=g.getFullYear(),C=(g.getMonth()+1).toString().padStart(2,"0"),de=g.getDate().toString().padStart(2,"0"),U=`${a}-${C}-${de}`;r.push({date:U,label:g.toLocaleDateString("id-ID",{day:"numeric",month:"short"}),fullLabel:g.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"}),hasSchedule:h.allScheduledDates.includes(U)})}return r}),F=K(()=>h.scheduledDays[y.value]||[]),Q=Array.from({length:24},(r,e)=>e.toString().padStart(2,"0")),R=Array.from({length:60},(r,e)=>e.toString().padStart(2,"0")),q=r=>{const e=new Date(D.value);e.setDate(D.value.getDate()+r*Z),M.get(route("admin.schedules.show",h.schedule.id),{start_date:e.toISOString().slice(0,10)},{preserveState:!0,preserveScroll:!0,replace:!0,onSuccess:m=>{D.value=new Date(m.props.startDate+"T00:00:00"),y.value=m.props.startDate}})},X=()=>q(-1),ee=()=>q(1),N=()=>(s.clearErrors(),s.media_id?!0:(s.setError("media_id","Media wajib dipilih."),!1)),O=r=>{_.value=!1,s.reset(),s.clearErrors(),s.schedule_date=r,S.value=!0},te=r=>{_.value=!0,s.reset(),s.clearErrors();const e=new Date(r.play_at);s.id=r.id,s.schedule_date=y.value,s.play_hour=e.getHours().toString().padStart(2,"0"),s.play_minute=e.getMinutes().toString().padStart(2,"0"),s.media_id=r.media_id,S.value=!0},V=()=>{S.value=!1},ae=async()=>{if(!N())return;s.processing=!0;const e={play_time:`${s.play_hour}:${s.play_minute}`,schedule_date:s.schedule_date,media_id:s.media_id,schedule_id:h.schedule.id},m=_.value?route("api.admin.schedule-items.update",s.id):route("api.admin.schedule-items.store"),g=_.value?"put":"post";try{const a=await J[g](m,e);V(),M.reload({only:["scheduledDays","allScheduledDates"],onSuccess:()=>w(a.data.message,"success")})}catch(a){a.response&&a.response.status===422?s.setError(a.response.data.errors):w("Terjadi kesalahan tak terduga.","error")}finally{s.processing=!1}},se=r=>{confirm(`Yakin ingin menghapus jadwal "${r.media.title}"?`)&&J.delete(route("api.admin.schedule-items.destroy",r.id)).then(()=>{M.reload({only:["scheduledDays","allScheduledDates"],preserveScroll:!0,onSuccess:()=>{w("Item jadwal berhasil dihapus.","success")}})}).catch(e=>{w("Gagal menghapus item.","error"),console.error("Deletion error:",e)})},re=r=>{I.value=r,u.reset(),u.target_date=new Date().toISOString().slice(0,10),j.value=!0},B=()=>{j.value=!1},oe=()=>{u.processing=!0,u.error=null,J.post(route("api.admin.copydate",h.schedule.id),{source_date:I.value,target_date:u.target_date}).then(r=>{B(),M.reload({onSuccess:()=>{w(r.data.message,"success")}})}).catch(r=>{r.response&&r.response.data&&r.response.data.message?u.error=r.response.data.message:u.error="Terjadi kesalahan tak terduga. Silakan coba lagi."}).finally(()=>{u.processing=!1})},le=r=>r?new Date(r).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}):"",w=(r,e="info")=>{x.value={message:r,type:e,show:!0},setTimeout(()=>{x.value.show=!1},4e3)};return(r,e)=>(d(),n(k,null,[l(o(ne),{title:`Jadwal untuk ${v.schedule.name}`},null,8,["title"]),l(ge,null,{header:p(()=>[t("div",we,[l(o(ce),{href:r.route("admin.schedules.index"),class:"mr-4 text-gray-500 hover:text-gray-700"},{default:p(()=>e[8]||(e[8]=[c("← Kembali")])),_:1},8,["href"]),t("h2",be,[e[9]||(e[9]=c(" Jadwal untuk ")),t("span",Se,i(v.schedule.name),1)])])]),default:p(()=>{var m,g;return[l(he,{message:x.value.message,type:x.value.type,show:x.value.show,onClose:e[0]||(e[0]=a=>x.value.show=!1)},null,8,["message","type","show"]),t("div",De,[t("div",Ce,[t("div",$e,[t("button",{onClick:X,class:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"Halaman sebelumnya"},[l(o(_e),{class:"h-5 w-5 text-gray-500"})]),t("div",Me,[(d(!0),n(k,null,b(T.value,a=>(d(),n("button",{key:a.date,onClick:C=>y.value=a.date,class:A(["px-3 py-2 text-xs font-medium rounded-md transition-colors duration-200 text-center",y.value===a.date?"bg-[--color-primary-600] text-white shadow":a.hasSchedule?"bg-green-100 dark:bg-green-800/50 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-700/50":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"])},i(a.label),11,je))),128))]),t("button",{onClick:ee,class:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"Halaman berikutnya"},[l(o(xe),{class:"h-5 w-5 text-gray-500"})])]),t("div",Ie,[F.value.length>0?(d(),n("div",Te,[t("div",Ve,[t("h3",Be,i((m=T.value.find(a=>a.date===y.value))==null?void 0:m.fullLabel),1),t("div",Ae,[t("button",{onClick:e[1]||(e[1]=a=>re(y.value)),class:"text-sm font-semibold text-gray-500 hover:text-gray-700 flex items-center gap-1"},[l(o(ke),{class:"h-4 w-4"}),e[10]||(e[10]=c(" Salin Jadwal "))]),t("button",{onClick:e[2]||(e[2]=a=>O(y.value)),class:"text-sm font-semibold text-[--color-primary-600] hover:text-[--color-primary-500] flex items-center gap-1"},[l(o(G),{class:"h-4 w-4"}),e[11]||(e[11]=c(" Tambah Item "))])])]),t("ul",Ee,[(d(!0),n(k,null,b(F.value,a=>(d(),n("li",{key:a.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-md"},[t("div",He,[t("span",Je,i(le(a.play_at)),1),t("p",Le,i(a.media.title),1),t("span",Pe,"("+i(a.media.duration)+" detik)",1)]),t("div",null,[t("button",{onClick:C=>te(a),class:"text-gray-400 hover:text-gray-600 dark:hover:text-white","aria-label":"Edit item"},[l(o(ve),{class:"h-5 w-5"})],8,Fe),t("button",{onClick:C=>se(a),class:"p-1 text-red-400 hover:text-red-600 dark:hover:text-red-300","aria-label":"Hapus item"},[l(o(fe),{class:"h-5 w-5"})],8,qe)])]))),128))])])):(d(),n("div",Ne,[l(o(me),{class:"mx-auto h-12 w-12 text-gray-400"}),e[13]||(e[13]=t("h3",{class:"mt-2 text-sm font-semibold text-gray-900 dark:text-white"},"Jadwal Kosong",-1)),t("p",Oe,"Belum ada jadwal untuk tanggal "+i((g=T.value.find(a=>a.date===y.value))==null?void 0:g.fullLabel)+".",1),t("div",Ue,[l(P,{onClick:e[3]||(e[3]=a=>O(y.value))},{default:p(()=>[l(o(G),{class:"h-5 w-5 mr-2"}),e[12]||(e[12]=c(" Buat Jadwal untuk Tanggal Ini "))]),_:1})])]))])])]),l(Y,{show:S.value,onClose:V},{default:p(()=>[t("form",{onSubmit:ie(ae,["prevent"]),class:"p-6",novalidate:""},[t("h2",We,i(_.value?"Edit":"Tambah")+" Item Jadwal ",1),t("p",Ke,"untuk tanggal "+i(o(s).schedule_date),1),t("div",Ye,[t("div",null,[l(L,{for:"play_hour",value:"Waktu Putar",required:""}),t("div",ze,[E(t("select",{id:"play_hour","onUpdate:modelValue":e[4]||(e[4]=a=>o(s).play_hour=a),class:"w-full border-gray-300 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[(d(!0),n(k,null,b(o(Q),a=>(d(),n("option",{key:a,value:a},i(a),9,Ge))),128))],512),[[H,o(s).play_hour]]),e[14]||(e[14]=t("span",{class:"font-bold"},":",-1)),E(t("select",{id:"play_minute","onUpdate:modelValue":e[5]||(e[5]=a=>o(s).play_minute=a),class:"w-full border-gray-300 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[(d(!0),n(k,null,b(o(R),a=>(d(),n("option",{key:a,value:a},i(a),9,Ze))),128))],512),[[H,o(s).play_minute]])]),o(s).errors.play_time?(d(),n("p",Qe,i(o(s).errors.play_time),1)):$("",!0)]),t("div",null,[l(L,{for:"media_id",value:"Pilih Media",required:""}),E(t("select",{id:"media_id","onUpdate:modelValue":e[6]||(e[6]=a=>o(s).media_id=a),onChange:N,class:"mt-1 block w-full border-gray-300 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[15]||(e[15]=t("option",{disabled:"",value:""},"-- Pilih Media --",-1)),(d(!0),n(k,null,b(v.allMedia,a=>(d(),n("option",{key:a.id,value:a.id},i(a.title)+" ("+i(a.duration)+" detik) ",9,Re))),128))],544),[[H,o(s).media_id]]),o(s).errors.media_id?(d(),n("p",Xe,i(o(s).errors.media_id),1)):$("",!0)])]),t("div",et,[t("div",null,[_.value?(d(),ue(pe,{key:0,onClick:r.deleteItem,type:"button"},{default:p(()=>e[16]||(e[16]=[c("Hapus")])),_:1},8,["onClick"])):$("",!0)]),t("div",tt,[l(z,{onClick:V,type:"button"},{default:p(()=>e[17]||(e[17]=[c("Batal")])),_:1}),l(P,{class:A({"opacity-25":o(s).processing}),disabled:o(s).processing},{default:p(()=>e[18]||(e[18]=[c(" Simpan ")])),_:1},8,["class","disabled"])])])],32)]),_:1},8,["show"]),l(Y,{show:j.value,onClose:B},{default:p(()=>[t("div",at,[e[23]||(e[23]=t("h2",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," Salin Jadwal ",-1)),t("p",st,[e[19]||(e[19]=c(" Salin semua item dari tanggal ")),t("strong",null,i(I.value),1),e[20]||(e[20]=c(" ke tanggal tujuan. "))]),t("div",rt,[l(L,{for:"target_date",value:"Pilih Tanggal Tujuan",required:""}),l(ye,{id:"target_date",type:"date",class:"mt-1 block w-full",modelValue:o(u).target_date,"onUpdate:modelValue":e[7]||(e[7]=a=>o(u).target_date=a),required:""},null,8,["modelValue"])]),o(u).error?(d(),n("div",ot,i(o(u).error),1)):$("",!0),t("div",lt,[l(z,{onClick:B},{default:p(()=>e[21]||(e[21]=[c("Batal")])),_:1}),l(P,{onClick:oe,disabled:!o(u).target_date||o(u).processing,class:A({"opacity-25":o(u).processing})},{default:p(()=>e[22]||(e[22]=[c(" Salin Jadwal ")])),_:1},8,["disabled","class"])])])]),_:1},8,["show"])]}),_:1})],64))}};export{kt as default};
