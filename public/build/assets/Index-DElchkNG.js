import{j as H,i as x,r as y,x as I,k as O,W as v,f as w,o as u,a as s,u as l,g as Y,w as i,b as t,c as z,h as $,e as h,F as j,l as J,t as d,d as Q,n as M}from"./app-BLeNn4LO.js";import{A as R}from"./AuthenticatedLayout-HllnW7fv.js";import{_ as B}from"./PrimaryButton-6Sj3evt6.js";import{_ as N}from"./SecondaryButton-DvDU7CXS.js";import{_ as S,D as G}from"./Modal-xru5_Yyr.js";import{_ as k}from"./InputError-Bjz1dp-D.js";import{_ as b}from"./InputLabel-CgxTHTmz.js";import{_ as c}from"./TextInput-DSC7ne63.js";import{_ as X}from"./Toast-k947icgK.js";import{l as Z}from"./lodash-BnKdaLBk.js";import{r as ee}from"./PlusIcon-CiPOsjGh.js";import{r as ae,a as te}from"./TrashIcon-DwDMB_nq.js";import"./XMarkIcon-CnMNgzJZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ExclamationTriangleIcon-Dbmr1S3L.js";const se={class:"pb-12 pt-4"},oe={class:"max-w-full mx-auto"},le={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},re={class:"p-6 text-gray-900 dark:text-gray-100"},ne={class:"mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4"},ie={class:"flex-grow"},de={class:"overflow-x-auto"},me={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ue={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},ce={key:0},pe={class:"px-6 py-4 text-sm font-medium text-gray-900 dark:text-white"},fe={class:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300"},_e={class:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300"},ge={class:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300"},xe={class:"px-6 py-4 text-right text-sm font-medium"},ye=["onClick"],ve=["onClick"],we={class:"text-lg font-medium text-gray-900 dark:text-gray-100 border-b pb-3 mb-6"},he={class:"space-y-6"},ke={key:0},be={class:"mt-6 flex justify-end space-x-3 border-t pt-6"},Ce={class:"p-6"},Ve={class:"mt-2 text-sm text-gray-600"},Ee={class:"mt-6 flex justify-end space-x-3"},He={__name:"Index",setup(Ke){const p=H(),f=x(()=>p.props.clientList||{data:[]}),P=x(()=>p.props.filters||{search:""}),T=x(()=>p.props.can||{}),U=x(()=>{var r;return(r=p.props.flash)==null?void 0:r.message}),L=x(()=>{var r;return((r=p.props.flash)==null?void 0:r.type)||"info"}),C=y(!1),n=y(!1),e=I({id:null,company_name:"",contact_person:"",contact_email:"",password:"",password_confirmation:""}),_=y(!1),g=y(null),V=y(P.value.search);O(V,Z.debounce(r=>{v.get(route("admin.clients.index"),{search:r},{preserveState:!0,preserveScroll:!0,replace:!0,only:["clientList","filters"]})},300));const D=()=>{n.value=!1,e.reset(),e.clearErrors(),C.value=!0},q=r=>{const a=r.full_data_for_edit;n.value=!0,e.reset(),e.clearErrors(),e.id=a.id,e.company_name=a.company_name,e.contact_person=a.contact_person,e.contact_email=a.user.email,e.password="",e.password_confirmation="",C.value=!0},E=()=>{C.value=!1,e.reset()},A=()=>{e.clearErrors();let r=!1;if(e.company_name||(e.setError("company_name","Nama Perusahaan wajib diisi."),r=!0),e.contact_person||(e.setError("contact_person","Nama Narahubung wajib diisi."),r=!0),e.contact_email||(e.setError("contact_email","Email wajib diisi."),r=!0),!n.value&&!e.password&&(e.setError("password","Password wajib diisi untuk klien baru."),r=!0),e.password&&e.password!==e.password_confirmation&&(e.setError("password_confirmation","Konfirmasi password tidak cocok."),r=!0),r)return;const a=n.value?route("admin.clients.update",e.id):route("admin.clients.store"),m=n.value?"put":"post";e.submit(m,a,{preserveScroll:!0,onSuccess:()=>E(),onError:o=>console.error("Client form submission error:",o)})},W=r=>{g.value=r,_.value=!0},F=()=>{if(!g.value)return;const r=f.value.data,a=f.value.current_page,m=r.length===1&&a>1;v.delete(route("admin.clients.destroy",g.value.id),{preserveScroll:!0,onSuccess:()=>{_.value=!1,g.value=null,m&&v.get(route("admin.clients.index",{page:a-1,search:V.value}),{},{preserveState:!1})}})};return(r,a)=>(u(),w(j,null,[s(l(Y),{title:"Manajemen Klien"}),s(R,null,{header:i(()=>a[8]||(a[8]=[t("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"Manajemen Klien",-1)])),default:i(()=>{var m;return[s(X,{message:U.value,type:L.value},null,8,["message","type"]),t("div",se,[t("div",oe,[t("div",le,[t("div",re,[t("div",ne,[t("div",ie,[s(c,{type:"text",modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=o=>V.value=o),placeholder:"Cari perusahaan, kontak, email...",class:"w-full md:max-w-md"},null,8,["modelValue"])]),(m=T.value)!=null&&m.manage_clients?(u(),z(B,{key:0,onClick:D},{default:i(()=>[s(l(ee),{class:"-ml-0.5 mr-1.5 h-5 w-5"}),a[9]||(a[9]=h(" Tambah Klien Baru "))]),_:1})):$("",!0)]),t("div",de,[t("table",me,[a[11]||(a[11]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Perusahaan"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Narahubung"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Email (Login)"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tgl Terdaftar"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Aksi")])],-1)),t("tbody",ue,[!f.value.data||f.value.data.length===0?(u(),w("tr",ce,a[10]||(a[10]=[t("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-500"},"Tidak ada data klien.",-1)]))):(u(!0),w(j,{key:1},J(f.value.data,o=>(u(),w("tr",{key:o.id},[t("td",pe,d(o.company_name),1),t("td",fe,d(o.contact_person),1),t("td",_e,d(o.email),1),t("td",ge,d(o.created_at_formatted),1),t("td",xe,[t("button",{onClick:K=>q(o),class:"p-1 mr-2 text-indigo-600 hover:text-indigo-900",title:"Edit Klien"},[s(l(ae),{class:"h-5 w-5"})],8,ye),t("button",{onClick:K=>W(o),class:"p-1 text-red-600 hover:text-red-900",title:"Hapus Klien"},[s(l(te),{class:"h-5 w-5"})],8,ve)])]))),128))])])])])])])]),s(S,{show:C.value,onClose:E,maxWidth:"xl"},{default:i(()=>[t("form",{onSubmit:Q(A,["prevent"]),class:"p-6",novalidate:""},[t("h2",we,d(n.value?"Edit Klien":"Tambah Klien Baru"),1),t("div",he,[t("div",null,[s(b,{for:"company_name",value:"Nama Perusahaan",required:""}),s(c,{id:"company_name",modelValue:l(e).company_name,"onUpdate:modelValue":a[1]||(a[1]=o=>l(e).company_name=o),type:"text",class:"mt-1 block w-full",placeholder:"Cth: PT. Videotron Jaya"},null,8,["modelValue"]),s(k,{message:l(e).errors.company_name,class:"mt-2"},null,8,["message"])]),t("div",null,[s(b,{for:"contact_person",value:"Nama Narahubung",required:""}),s(c,{id:"contact_person",modelValue:l(e).contact_person,"onUpdate:modelValue":a[2]||(a[2]=o=>l(e).contact_person=o),type:"text",class:"mt-1 block w-full",placeholder:"Cth: Budi Santoso"},null,8,["modelValue"]),s(k,{message:l(e).errors.contact_person,class:"mt-2"},null,8,["message"])]),t("div",null,[s(b,{for:"contact_email",value:"Email (Untuk Login)",required:""}),s(c,{id:"contact_email",modelValue:l(e).contact_email,"onUpdate:modelValue":a[3]||(a[3]=o=>l(e).contact_email=o),type:"email",class:"mt-1 block w-full",placeholder:"Cth: kontak@videotronjaya.com"},null,8,["modelValue"]),s(k,{message:l(e).errors.contact_email,class:"mt-2"},null,8,["message"])]),t("div",null,[s(b,{for:"password",value:n.value?"Password Baru (Opsional)":"Password",required:!n.value},null,8,["value","required"]),s(c,{id:"password",modelValue:l(e).password,"onUpdate:modelValue":a[4]||(a[4]=o=>l(e).password=o),type:"password",class:"mt-1 block w-full",placeholder:n.value?"Isi jika ingin ganti password":"Minimal 8 karakter"},null,8,["modelValue","placeholder"]),s(k,{message:l(e).errors.password,class:"mt-2"},null,8,["message"])]),l(e).password?(u(),w("div",ke,[s(b,{for:"password_confirmation",value:"Konfirmasi Password",required:""}),s(c,{id:"password_confirmation",modelValue:l(e).password_confirmation,"onUpdate:modelValue":a[5]||(a[5]=o=>l(e).password_confirmation=o),type:"password",class:"mt-1 block w-full",placeholder:"Ulangi password"},null,8,["modelValue"]),s(k,{message:l(e).errors.password_confirmation,class:"mt-2"},null,8,["message"])])):$("",!0)]),t("div",be,[s(N,{onClick:E,type:"button"},{default:i(()=>a[12]||(a[12]=[h("Batal")])),_:1}),s(B,{disabled:l(e).processing,class:M({"opacity-25":l(e).processing})},{default:i(()=>[h(d(n.value?"Update Klien":"Simpan Klien"),1)]),_:1},8,["disabled","class"])])],32)]),_:1},8,["show"]),s(S,{show:_.value,onClose:a[7]||(a[7]=o=>_.value=!1),maxWidth:"md"},{default:i(()=>{var o;return[t("div",Ce,[a[15]||(a[15]=t("h2",{class:"text-lg font-medium text-gray-900"},"Konfirmasi Hapus Klien",-1)),t("p",Ve,' Yakin ingin menghapus klien "'+d((o=g.value)==null?void 0:o.company_name)+`"? Aksi ini akan ditandai sebagai 'dihapus' (soft delete). `,1),t("div",Ee,[s(N,{onClick:a[6]||(a[6]=K=>_.value=!1)},{default:i(()=>a[13]||(a[13]=[h("Batal")])),_:1}),s(G,{onClick:F,class:M({"opacity-25":l(v).processing}),disabled:l(v).processing},{default:i(()=>a[14]||(a[14]=[h(" Ya, Hapus ")])),_:1},8,["class","disabled"])])])]}),_:1},8,["show"])]}),_:1})],64))}};export{He as default};
