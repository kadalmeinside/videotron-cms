{
    "sourceFile": "resources/js/Pages/Admin/Schedules/Builder.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754162515193,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754162515193,
            "name": "Commit-0",
            "content": "<script setup>\nimport AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';\nimport { Head, Link, useForm, router } from '@inertiajs/vue3';\nimport { computed, ref } from 'vue';\nimport { PlusIcon, PencilIcon, TrashIcon, CalendarDaysIcon, ChevronLeftIcon, ChevronRightIcon, ClipboardDocumentIcon } from '@heroicons/vue/24/outline';\nimport Modal from '@/Components/Modal.vue';\nimport InputLabel from '@/Components/InputLabel.vue';\nimport PrimaryButton from '@/Components/PrimaryButton.vue';\nimport SecondaryButton from '@/Components/SecondaryButton.vue';\nimport DangerButton from '@/Components/DangerButton.vue';\nimport Toast from '@/Components/Toast.vue';\nimport TextInput from '@/Components/TextInput.vue';\nimport axios from 'axios';\n\nconst props = defineProps({\n    schedule: Object,\n    scheduledDays: Object,\n    allScheduledDates: Array,\n    allMedia: Array,\n    startDate: String,\n});\n\n// --- STATE MANAGEMENT ---\nconst showItemModal = ref(false);\nconst isEditMode = ref(false);\nconst localFlash = ref({ message: '', type: 'info', show: false });\nconst pageDuration = 14; // Harus sama dengan di controller\n\n// State untuk Tab & Paginasi\nconst activeDate = ref(props.startDate);\nconst pageStartDate = ref(new Date(props.startDate + 'T00:00:00'));\n\n// State untuk Modal Copy\nconst showCopyModal = ref(false);\nconst copySourceDate = ref(null);\n\n// --- FORMS ---\nconst form = useForm({\n    id: null,\n    schedule_date: '',\n    play_hour: '07',\n    play_minute: '00',\n    media_id: '',\n});\n\nconst copyForm = useForm({\n    target_date: '',\n    error: null,\n});\n\n\nconst dateTabs = computed(() => {\n    const dates = [];\n    const baseDate = new Date(pageStartDate.value);\n    \n    for (let i = 0; i < pageDuration; i++) {\n        const current = new Date(baseDate);\n        current.setDate(baseDate.getDate() + i);\n\n        const year = current.getFullYear();\n        const month = (current.getMonth() + 1).toString().padStart(2, '0');\n        const day = current.getDate().toString().padStart(2, '0');\n        const dateString = `${year}-${month}-${day}`;\n\n        dates.push({\n            date: dateString,\n            label: current.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }),\n            fullLabel: current.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' }),\n            hasSchedule: props.allScheduledDates.includes(dateString),\n        });\n    }\n    return dates;\n});\n\nconst activeDayItems = computed(() => props.scheduledDays[activeDate.value] || []);\n\nconst hours = Array.from({ length: 24 }, (_, i) => i.toString().padStart(2, '0'));\nconst minutes = Array.from({ length: 60 }, (_, i) => i.toString().padStart(2, '0'));\n\nconst changePage = (direction) => {\n    const newStartDate = new Date(pageStartDate.value);\n    newStartDate.setDate(pageStartDate.value.getDate() + (direction * pageDuration));\n\n    router.get(route('admin.schedules.show', props.schedule.id), {\n        start_date: newStartDate.toISOString().slice(0, 10)\n    }, {\n        preserveState: true,\n        preserveScroll: true,\n        replace: true,\n        onSuccess: (page) => {\n            pageStartDate.value = new Date(page.props.startDate + 'T00:00:00');\n            activeDate.value = page.props.startDate;\n        }\n    });\n};\n\nconst prevPage = () => changePage(-1);\nconst nextPage = () => changePage(1);\n\nconst validateForm = () => {\n    form.clearErrors();\n    if (!form.media_id) {\n        form.setError('media_id', 'Media wajib dipilih.');\n        return false;\n    }\n    return true;\n}\n\nconst openAddItemModal = (date) => {\n    isEditMode.value = false;\n    form.reset();\n    form.clearErrors();\n    form.schedule_date = date;\n    showItemModal.value = true;\n};\n\nconst openEditItemModal = (item) => {\n    isEditMode.value = true;\n    form.reset();\n    form.clearErrors();\n    const playAtDate = new Date(item.play_at);\n    form.id = item.id;\n    form.schedule_date = activeDate.value;\n    form.play_hour = playAtDate.getHours().toString().padStart(2, '0');\n    form.play_minute = playAtDate.getMinutes().toString().padStart(2, '0');\n    form.media_id = item.media_id;\n    showItemModal.value = true;\n};\n\nconst closeModal = () => {\n    showItemModal.value = false;\n};\n\nconst saveItem = async () => {\n    if (!validateForm()) return;\n    form.processing = true;\n    const play_time = `${form.play_hour}:${form.play_minute}`;\n    const dataToSend = {\n        play_time: play_time,\n        schedule_date: form.schedule_date,\n        media_id: form.media_id,\n        schedule_id: props.schedule.id,\n    };\n    const url = isEditMode.value ? route('api.admin.schedule-items.update', form.id) : route('api.admin.schedule-items.store');\n    const method = isEditMode.value ? 'put' : 'post';\n\n    try {\n        const response = await axios[method](url, dataToSend);\n        closeModal();\n        router.reload({\n            only: ['scheduledDays', 'allScheduledDates'],\n            onSuccess: () => showToast(response.data.message, 'success'),\n        });\n    } catch (error) {\n        if (error.response && error.response.status === 422) {\n            form.setError(error.response.data.errors);\n        } else {\n            showToast('Terjadi kesalahan tak terduga.', 'error');\n        }\n    } finally {\n        form.processing = false;\n    }\n};\n\nconst confirmAndDeleteItem = (item) => {\n    // Minta konfirmasi dari pengguna sebelum menghapus\n    if (!confirm(`Yakin ingin menghapus jadwal \"${item.media.title}\"?`)) {\n        return;\n    }\n\n    // Panggil endpoint API untuk menghapus item\n    axios.delete(route('api.admin.schedule-items.destroy', item.id))\n        .then(() => {\n            // Jika berhasil, muat ulang data jadwal dari server\n            router.reload({\n                only: ['scheduledDays', 'allScheduledDates'],\n                preserveScroll: true,\n                onSuccess: () => {\n                    showToast('Item jadwal berhasil dihapus.', 'success');\n                }\n            });\n        })\n        .catch(error => {\n            // Jika gagal, tampilkan pesan error\n            showToast('Gagal menghapus item.', 'error');\n            console.error('Deletion error:', error);\n        });\n};\n\nconst openCopyModal = (date) => {\n    copySourceDate.value = date;\n    copyForm.reset();\n    copyForm.target_date = new Date().toISOString().slice(0, 10);\n    showCopyModal.value = true;\n};\n\nconst closeCopyModal = () => {\n    showCopyModal.value = false;\n};\n\nconst submitCopy = () => {\n    copyForm.processing = true;\n    copyForm.error = null;\n    \n    axios.post(route('api.admin.copydate', props.schedule.id), {\n        source_date: copySourceDate.value,\n        target_date: copyForm.target_date,\n    })\n    .then(response => {\n        closeCopyModal();\n        router.reload({ \n            onSuccess: () => {\n                showToast(response.data.message, 'success');\n            }\n        });\n    })\n    .catch(error => {\n        if (error.response && error.response.data && error.response.data.message) {\n            copyForm.error = error.response.data.message;\n        } else {\n            copyForm.error = 'Terjadi kesalahan tak terduga. Silakan coba lagi.';\n        }\n    })\n    .finally(() => {\n        copyForm.processing = false;\n    });\n};\n\n// --- HELPER FUNCTIONS ---\nconst formatTime = (datetime) => {\n    if (!datetime) return '';\n    return new Date(datetime).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });\n};\n\nconst showToast = (message, type = 'info') => {\n    localFlash.value = { message, type, show: true };\n    setTimeout(() => { localFlash.value.show = false; }, 4000);\n};\n\n</script>\n\n<template>\n    <Head :title=\"`Jadwal untuk ${schedule.name}`\" />\n    <AuthenticatedLayout>\n        <template #header>\n            <div class=\"flex items-center\">\n                <Link :href=\"route('admin.schedules.index')\" class=\"mr-4 text-gray-500 hover:text-gray-700\">&larr; Kembali</Link>\n                <h2 class=\"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight\">\n                    Jadwal untuk <span class=\"text-[--color-primary-600]\">{{ schedule.name }}</span>\n                </h2>\n            </div>\n        </template>\n        \n        <Toast :message=\"localFlash.message\" :type=\"localFlash.type\" :show=\"localFlash.show\" @close=\"localFlash.show = false\" />\n\n        <div class=\"pb-12 pt-4\">\n            <div class=\"max-w-full mx-auto\">\n                <div class=\"mb-6 bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm flex items-center gap-2\">\n                    <button @click=\"prevPage\" class=\"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700\" aria-label=\"Halaman sebelumnya\">\n                        <ChevronLeftIcon class=\"h-5 w-5 text-gray-500\" />\n                    </button>\n\n                    <div class=\"flex-grow grid grid-cols-7 md:grid-cols-14 gap-1\">\n                         <button v-for=\"tab in dateTabs\" :key=\"tab.date\" @click=\"activeDate = tab.date\"\n                            :class=\"[\n                                'px-3 py-2 text-xs font-medium rounded-md transition-colors duration-200 text-center',\n                                activeDate === tab.date\n                                    ? 'bg-[--color-primary-600] text-white shadow'\n                                    : tab.hasSchedule\n                                        ? 'bg-green-100 dark:bg-green-800/50 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-700/50'\n                                        : 'text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700'\n                            ]\">\n                            {{ tab.label }}\n                        </button>\n                    </div>\n\n                     <button @click=\"nextPage\" class=\"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700\" aria-label=\"Halaman berikutnya\">\n                        <ChevronRightIcon class=\"h-5 w-5 text-gray-500\" />\n                    </button>\n                </div>\n\n                <div class=\"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg\">\n                    <div v-if=\"activeDayItems.length > 0\" class=\"p-6\">\n                        <div class=\"flex justify-between items-center border-b pb-2 mb-4\">\n                            <h3 class=\"text-lg font-medium text-gray-900 dark:text-white\">\n                                {{ dateTabs.find(t => t.date === activeDate)?.fullLabel }}\n                            </h3>\n                             <div class=\"flex items-center gap-x-4\">\n                                <button @click=\"openCopyModal(activeDate)\" class=\"text-sm font-semibold text-gray-500 hover:text-gray-700 flex items-center gap-1\">\n                                    <ClipboardDocumentIcon class=\"h-4 w-4\" /> Salin Jadwal\n                                </button>\n                                <button @click=\"openAddItemModal(activeDate)\" class=\"text-sm font-semibold text-[--color-primary-600] hover:text-[--color-primary-500] flex items-center gap-1\">\n                                    <PlusIcon class=\"h-4 w-4\" /> Tambah Item\n                                </button>\n                            </div>\n                        </div>\n                        \n                        <ul class=\"space-y-3\">\n                            <li v-for=\"item in activeDayItems\" :key=\"item.id\" class=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-md\">\n                                <div class=\"flex items-center gap-4\">\n                                    <span class=\"font-mono text-lg text-[--color-primary-600] dark:text-[--color-primary-400]\">{{ formatTime(item.play_at) }}</span>\n                                    <p class=\"font-medium text-gray-800 dark:text-gray-200\">{{ item.media.title }}</p>\n                                    <span class=\"text-xs text-gray-500\">({{ item.media.duration }} detik)</span>\n                                </div>\n                                <div>\n                                    <button @click=\"openEditItemModal(item)\" class=\"text-gray-400 hover:text-gray-600 dark:hover:text-white\" aria-label=\"Edit item\">\n                                        <PencilIcon class=\"h-5 w-5\" />\n                                    </button>\n                                    <button @click=\"confirmAndDeleteItem(item)\" class=\"p-1 text-red-400 hover:text-red-600 dark:hover:text-red-300\" aria-label=\"Hapus item\">\n                                        <TrashIcon class=\"h-5 w-5\" />\n                                    </button>\n                                </div>\n                            </li>\n                        </ul>\n                    </div>\n                    \n                    <div v-else class=\"text-center p-12\">\n                         <CalendarDaysIcon class=\"mx-auto h-12 w-12 text-gray-400\" />\n                        <h3 class=\"mt-2 text-sm font-semibold text-gray-900 dark:text-white\">Jadwal Kosong</h3>\n                        <p class=\"mt-1 text-sm text-gray-500\">Belum ada jadwal untuk tanggal {{ dateTabs.find(t => t.date === activeDate)?.fullLabel }}.</p>\n                        <div class=\"mt-6\">\n                            <PrimaryButton @click=\"openAddItemModal(activeDate)\">\n                                <PlusIcon class=\"h-5 w-5 mr-2\" /> Buat Jadwal untuk Tanggal Ini\n                            </PrimaryButton>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <Modal :show=\"showItemModal\" @close=\"closeModal\">\n             <form @submit.prevent=\"saveItem\" class=\"p-6\" novalidate>\n                <h2 class=\"text-lg font-medium text-gray-900 dark:text-gray-100\">\n                    {{ isEditMode ? 'Edit' : 'Tambah' }} Item Jadwal\n                </h2>\n                <p class=\"text-sm text-gray-500\">untuk tanggal {{ form.schedule_date }}</p>\n\n                <div class=\"mt-6 space-y-4\">\n                    <div>\n                        <InputLabel for=\"play_hour\" value=\"Waktu Putar\" required />\n                        <div class=\"flex items-center gap-2 mt-1\">\n                            <select id=\"play_hour\" v-model=\"form.play_hour\" class=\"w-full border-gray-300 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500\">\n                                <option v-for=\"h in hours\" :key=\"h\" :value=\"h\">{{ h }}</option>\n                            </select>\n                            <span class=\"font-bold\">:</span>\n                             <select id=\"play_minute\" v-model=\"form.play_minute\" class=\"w-full border-gray-300 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500\">\n                                <option v-for=\"m in minutes\" :key=\"m\" :value=\"m\">{{ m }}</option>\n                            </select>\n                        </div>\n                         <p v-if=\"form.errors.play_time\" class=\"text-sm text-red-600 dark:text-red-400 mt-2\">{{ form.errors.play_time }}</p>\n                    </div>\n                    \n                    <div>\n                        <InputLabel for=\"media_id\" value=\"Pilih Media\" required />\n                        <select id=\"media_id\" v-model=\"form.media_id\" @change=\"validateForm\" class=\"mt-1 block w-full border-gray-300 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500\">\n                            <option disabled value=\"\">-- Pilih Media --</option>\n                            <option v-for=\"media in allMedia\" :key=\"media.id\" :value=\"media.id\">\n                                {{ media.title }} ({{ media.duration }} detik)\n                            </option>\n                        </select>\n                         <p v-if=\"form.errors.media_id\" class=\"text-sm text-red-600 dark:text-red-400 mt-2\">{{ form.errors.media_id }}</p>\n                    </div>\n                </div>\n\n                <div class=\"mt-6 flex justify-between\">\n                    <div>\n                        <DangerButton v-if=\"isEditMode\" @click=\"deleteItem\" type=\"button\">Hapus</DangerButton>\n                    </div>\n                    <div class=\"flex justify-end gap-x-2\">\n                        <SecondaryButton @click=\"closeModal\" type=\"button\">Batal</SecondaryButton>\n                        <PrimaryButton :class=\"{ 'opacity-25': form.processing }\" :disabled=\"form.processing\">\n                            Simpan\n                        </PrimaryButton>\n                    </div>\n                </div>\n            </form>\n        </Modal>\n\n        <Modal :show=\"showCopyModal\" @close=\"closeCopyModal\">\n            <div class=\"p-6\">\n                <h2 class=\"text-lg font-medium text-gray-900 dark:text-gray-100\">\n                    Salin Jadwal\n                </h2>\n                <p class=\"text-sm text-gray-500 mt-1\">\n                    Salin semua item dari tanggal <strong>{{ copySourceDate }}</strong> ke tanggal tujuan.\n                </p>\n\n                <div class=\"mt-6\">\n                    <InputLabel for=\"target_date\" value=\"Pilih Tanggal Tujuan\" required />\n                    <TextInput\n                        id=\"target_date\"\n                        type=\"date\"\n                        class=\"mt-1 block w-full\"\n                        v-model=\"copyForm.target_date\"\n                        required\n                    />\n                </div>\n\n                <div v-if=\"copyForm.error\" class=\"mt-4 p-3 bg-red-100 border border-red-200 text-red-800 rounded-md text-sm\">\n                    {{ copyForm.error }}\n                </div>\n\n                <div class=\"mt-6 flex justify-end gap-x-2\">\n                    <SecondaryButton @click=\"closeCopyModal\">Batal</SecondaryButton>\n                    <PrimaryButton @click=\"submitCopy\" :disabled=\"!copyForm.target_date || copyForm.processing\" :class=\"{'opacity-25': copyForm.processing}\">\n                        Salin Jadwal\n                    </PrimaryButton>\n                </div>\n            </div>\n        </Modal>\n\n    </AuthenticatedLayout>\n</template>"
        }
    ]
}