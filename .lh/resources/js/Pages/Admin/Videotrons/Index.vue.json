{
    "sourceFile": "resources/js/Pages/Admin/Videotrons/Index.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754161105817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754161105817,
            "name": "Commit-0",
            "content": "<script setup>\nimport AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';\nimport { Head, Link, useForm, usePage, router } from '@inertiajs/vue3';\nimport PrimaryButton from '@/Components/PrimaryButton.vue';\nimport SecondaryButton from '@/Components/SecondaryButton.vue';\nimport DangerButton from '@/Components/DangerButton.vue';\nimport Modal from '@/Components/Modal.vue';\nimport InputError from '@/Components/InputError.vue';\nimport InputLabel from '@/Components/InputLabel.vue';\nimport TextInput from '@/Components/TextInput.vue';\nimport Toast from '@/Components/Toast.vue';\nimport { PlusIcon, PencilIcon, TrashIcon, XMarkIcon, ClockIcon, ArrowPathIcon, ArrowUpTrayIcon } from '@heroicons/vue/20/solid';\nimport { ref, watch, computed } from 'vue';\nimport { debounce } from 'lodash';\n\n// Computed Props\nconst page = usePage();\nconst videotronList = computed(() => page.props.videotronList || { data: [] });\nconst filters = computed(() => page.props.filters || { search: '', status: '' });\nconst can = computed(() => page.props.can || {});\nconst flashMessage = computed(() => page.props.flash?.message);\nconst flashType = computed(() => page.props.flash?.type || 'info');\n\nconst props = defineProps({\n    allPlaylists: Array, \n    allSchedules: Array,\n    latest_app_version: Number,\n});\n\n// State\nconst showVideotronModal = ref(false);\nconst isEditMode = ref(false);\nconst showDeleteConfirmModal = ref(false);\nconst videotronToDelete = ref(null);\nconst searchQuery = ref(filters.value.search);\nconst statusFilter = ref(filters.value.status);\nconst actionInProgressId = ref(null); // State loading untuk semua aksi\n\nconst form = useForm({\n    id: null,\n    name: '',\n    location_name: '',\n    latitude: '',\n    longitude: '',\n    resolution: '',\n    status: 'active',\n    device_id: '',\n    password: '',\n    playlist_id: '',\n    schedule_id: '',\n});\n\n// Watcher untuk semua filter\nwatch([searchQuery, statusFilter], debounce(() => {\n    router.get(route('admin.videotrons.index'), { \n        search: searchQuery.value,\n        status: statusFilter.value,\n    }, {\n        preserveState: true,\n        preserveScroll: true,\n        replace: true,\n        only: ['videotronList', 'filters'],\n    });\n}, 300));\n\nconst clearSearch = () => {\n    searchQuery.value = '';\n};\n\n// --- FUNGSI AKSI ---\nconst forceSync = (videotron) => {\n    actionInProgressId.value = videotron.id + '_sync';\n    router.post(route('admin.videotrons.force-sync', videotron.id), {}, {\n        preserveScroll: true,\n        onFinish: () => { actionInProgressId.value = null; }\n    });\n};\n\nconst forceUpdate = (videotron) => {\n    actionInProgressId.value = videotron.id + '_update';\n    router.post(route('admin.videotrons.force-update', videotron.id), {}, {\n        preserveScroll: true,\n        onFinish: () => { actionInProgressId.value = null; }\n    });\n};\n\nconst openCreateModal = () => {\n    isEditMode.value = false;\n    form.reset();\n    form.clearErrors();\n    showVideotronModal.value = true;\n};\n\nconst openEditModal = (videotron) => {\n    isEditMode.value = true;\n    form.reset();\n    form.clearErrors();\n    form.id = videotron.id;\n    form.name = videotron.name;\n    form.location_name = videotron.location_name;\n    form.latitude = videotron.latitude;\n    form.longitude = videotron.longitude;\n    form.resolution = videotron.resolution;\n    form.status = videotron.status;\n    form.device_id = videotron.device_id;\n    form.playlist_id = videotron.playlist_id || '';\n    form.schedule_id = videotron.schedule_id || '';\n    showVideotronModal.value = true;\n};\n\nconst closeModal = () => {\n    showVideotronModal.value = false;\n};\n\nconst submitVideotronForm = () => {\n    const routeName = isEditMode.value ? 'admin.videotrons.update' : 'admin.videotrons.store';\n    const routeParams = isEditMode.value ? form.id : undefined;\n    \n    form.submit(isEditMode.value ? 'put' : 'post', route(routeName, routeParams), {\n        preserveScroll: true,\n        onSuccess: () => closeModal(),\n    });\n};\n\nconst confirmDeleteVideotron = (videotron) => {\n    videotronToDelete.value = videotron;\n    showDeleteConfirmModal.value = true;\n};\n\nconst deleteVideotron = () => {\n    if (!videotronToDelete.value) return;\n    router.delete(route('admin.videotrons.destroy', videotronToDelete.value.id), {\n        preserveScroll: true,\n        onSuccess: () => { showDeleteConfirmModal.value = false; },\n    });\n};\n\n</script>\n\n<template>\n    <Head title=\"Manajemen Videotron\" />\n\n    <AuthenticatedLayout>\n        <template #header>\n            <h2 class=\"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight\">Manajemen Videotron</h2>\n        </template>\n\n        <Toast :message=\"flashMessage\" :type=\"flashType\" />\n\n        <div class=\"pb-12 pt-4\">\n            <div class=\"max-w-full mx-auto\">\n                <div class=\"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg\">\n                    <div class=\"p-6 text-gray-900 dark:text-gray-100\">\n                        <div class=\"mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4\">\n                            <div class=\"flex flex-col sm:flex-row gap-4 w-full md:w-auto\">\n                                <!-- Search Input -->\n                                <div class=\"relative w-full sm:w-64\">\n                                    <TextInput \n                                        type=\"text\" \n                                        v-model=\"searchQuery\" \n                                        placeholder=\"Cari...\" \n                                        class=\"w-full pr-10\" \n                                    />\n                                    <button v-if=\"searchQuery\" @click=\"clearSearch\" type=\"button\" class=\"absolute inset-y-0 right-0 flex items-center pr-3\">\n                                        <XMarkIcon class=\"h-5 w-5 text-gray-400\" />\n                                    </button>\n                                </div>\n                                <!-- Filter Status -->\n                                <select v-model=\"statusFilter\" class=\"w-full sm:w-48 border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm\">\n                                    <option value=\"\">Semua Status</option>\n                                    <option value=\"online\">Online</option>\n                                    <option value=\"offline\">Offline</option>\n                                </select>\n                            </div>\n                            <PrimaryButton @click=\"openCreateModal\" v-if=\"can?.manage_videotrons\">\n                                <PlusIcon class=\"h-5 w-5 mr-2\" /> Tambah Videotron\n                            </PrimaryButton>\n                        </div>\n\n                        <div v-if=\"!videotronList.data.length\" class=\"text-center py-12 text-gray-500\">\n                            Tidak ada data untuk ditampilkan.\n                        </div>\n                        <div v-else>\n                            <div class=\"hidden md:block overflow-x-auto\">\n                                <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                                    <thead class=\"bg-gray-50 dark:bg-gray-700/50\">\n                                        <tr>\n                                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">Nama</th>\n                                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">Status Online</th>\n                                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">Versi App</th>\n                                            <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">Terakhir Terlihat</th>\n                                            <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">Aksi</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody class=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\n                                        <tr v-for=\"item in videotronList.data\" :key=\"item.id\">\n                                            <td class=\"px-6 py-4 font-medium\">{{ item.name }}</td>\n                                            <td class=\"px-6 py-4\">\n                                                <span v-if=\"item.is_online\" class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100\">Online</span>\n                                                <span v-else class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100\">Offline</span>\n                                            </td>\n                                            <td class=\"px-6 py-4 text-sm\">\n                                                <span v-if=\"item.app_version_code < latest_app_version\" class=\"text-yellow-600 dark:text-yellow-400 font-bold\" title=\"Versi lama\">{{ item.app_version_code || 'N/A' }}</span>\n                                                <span v-else class=\"text-gray-500 dark:text-gray-400\">{{ item.app_version_code || 'N/A' }}</span>\n                                            </td>\n                                            <td class=\"px-6 py-4 text-sm text-gray-500 dark:text-gray-400\">{{ item.last_seen_at_for_humans }}</td>\n                                            <td class=\"px-6 py-4 text-right space-x-2\">\n                                                <button @click=\"forceUpdate(item)\" class=\"p-1 text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300 disabled:opacity-50 disabled:cursor-not-allowed\" :disabled=\"!item.fcm_token || actionInProgressId || item.app_version_code >= latest_app_version\" title=\"Force Update App\">\n                                                    <ArrowUpTrayIcon class=\"h-5 w-5\" :class=\"{'animate-spin': actionInProgressId === item.id + '_update'}\" />\n                                                </button>\n                                                <button @click=\"forceSync(item)\" class=\"p-1 text-sky-600 hover:text-sky-900 dark:text-sky-400 dark:hover:text-sky-300 disabled:opacity-50 disabled:cursor-not-allowed\" :disabled=\"!item.fcm_token || actionInProgressId\" title=\"Force Sync Content\">\n                                                    <ArrowPathIcon class=\"h-5 w-5\" :class=\"{'animate-spin': actionInProgressId === item.id + '_sync'}\" />\n                                                </button>\n                                                <button @click=\"openEditModal(item)\" class=\"p-1 text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300\"><PencilIcon class=\"h-5 w-5\" /></button>\n                                                <button @click=\"confirmDeleteVideotron(item)\" class=\"p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300\"><TrashIcon class=\"h-5 w-5\" /></button>\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n\n                            <!-- Mobile View -->\n                            <div class=\"md:hidden space-y-4\">\n                                <div v-for=\"item in videotronList.data\" :key=\"item.id\" class=\"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg shadow\">\n                                    <div class=\"flex justify-between items-start mb-3\">\n                                        <h3 class=\"font-bold text-lg pr-4\">{{ item.name }}</h3>\n                                        <div class=\"flex-shrink-0\">\n                                            <button @click=\"forceUpdate(item)\" class=\"p-1 mr-2 text-orange-600 hover:text-orange-900 disabled:opacity-50\" :disabled=\"!item.fcm_token || actionInProgressId || item.app_version_code >= latest_app_version\" title=\"Force Update App\">\n                                                <ArrowUpTrayIcon class=\"h-5 w-5\" :class=\"{'animate-spin': actionInProgressId === item.id + '_update'}\" />\n                                            </button>\n                                            <button @click=\"forceSync(item)\" class=\"p-1 mr-2 text-sky-600 hover:text-sky-900 disabled:opacity-50\" :disabled=\"!item.fcm_token || actionInProgressId\" title=\"Force Sync Content\">\n                                                <ArrowPathIcon class=\"h-5 w-5\" :class=\"{'animate-spin': actionInProgressId === item.id + '_sync'}\" />\n                                            </button>\n                                            <button @click=\"openEditModal(item)\" class=\"p-1 mr-2 text-indigo-600 hover:text-indigo-900\"><PencilIcon class=\"h-5 w-5\" /></button>\n                                            <button @click=\"confirmDeleteVideotron(item)\" class=\"p-1 text-red-600 hover:text-red-900\"><TrashIcon class=\"h-5 w-5\" /></button>\n                                        </div>\n                                    </div>\n                                    <div class=\"space-y-2 text-sm\">\n                                        <div class=\"flex justify-between\">\n                                            <span class=\"text-gray-500 dark:text-gray-400\">Device ID:</span>\n                                            <span class=\"font-mono text-xs text-gray-500 dark:text-gray-400\">{{ item.device_id || '-' }}</span>\n                                        </div>\n                                        <div class=\"flex justify-between items-center\">\n                                            <span class=\"text-gray-500 dark:text-gray-400\">Status Online:</span>\n                                            <div>\n                                                <span v-if=\"item.is_online\" class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100\">Online</span>\n                                                <span v-else class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100\">Offline</span>\n                                            </div>\n                                        </div>\n                                        <div class=\"flex justify-between items-center\">\n                                            <span class=\"text-gray-500 dark:text-gray-400\">Versi App:</span>\n                                            <span v-if=\"item.app_version_code < latest_app_version\" class=\"text-yellow-600 dark:text-yellow-400 font-bold\" title=\"Versi lama\">{{ item.app_version_code || 'N/A' }}</span>\n                                            <span v-else class=\"text-gray-500 dark:text-gray-400\">{{ item.app_version_code || 'N/A' }}</span>\n                                        </div>\n                                        <div class=\"flex justify-between items-center text-gray-500 dark:text-gray-400\">\n                                            <ClockIcon class=\"h-4 w-4 mr-1\"/>\n                                            <span>{{ item.last_seen_at_for_humans }}</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div v-if=\"videotronList.links.length > 3\" class=\"mt-6 flex justify-center\">\n                            <div class=\"flex flex-wrap -mb-1\">\n                                <template v-for=\"(link, key) in videotronList.links\" :key=\"key\">\n                                    <div v-if=\"link.url === null\"\n                                         class=\"mr-1 mb-1 px-4 py-3 text-sm leading-4 text-gray-400 border rounded\"\n                                         v-html=\"link.label\" />\n                                    <Link v-else\n                                          class=\"mr-1 mb-1 px-4 py-3 text-sm leading-4 border rounded hover:bg-white dark:hover:bg-gray-700 focus:border-indigo-500 focus:text-indigo-500\"\n                                          :class=\"{ 'bg-blue-600 text-white dark:bg-blue-500': link.active }\"\n                                          :href=\"link.url\"\n                                          v-html=\"link.label\"\n                                          preserve-scroll />\n                                </template>\n                            </div>\n                        </div>\n\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <Modal :show=\"showVideotronModal\" @close=\"closeModal\" maxWidth=\"2xl\">\n            <form @submit.prevent=\"submitVideotronForm\" class=\"p-6\" novalidate>\n                <h2 class=\"text-lg font-medium text-gray-900 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-3 mb-6\">{{ isEditMode ? 'Edit' : 'Tambah' }} Videotron</h2>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                        <InputLabel for=\"name\" value=\"Nama Videotron\" required />\n                        <TextInput id=\"name\" v-model=\"form.name\" class=\"mt-1 w-full\" placeholder=\"Cth: VTR-JKT-01\" />\n                        <InputError :message=\"form.errors.name\" class=\"mt-2\" />\n                    </div>\n                    <div class=\"md:col-span-2\">\n                        <InputLabel for=\"device_id\" value=\"Device ID (dari STB)\" />\n                        <TextInput id=\"device_id\" v-model=\"form.device_id\" class=\"mt-1 w-full font-mono\" placeholder=\"ID unik dari perangkat Android\" />\n                        <InputError :message=\"form.errors.device_id\" class=\"mt-2\" />\n                    </div>\n                    <div class=\"md:col-span-2\">\n                        <InputLabel for=\"password\" value=\"Password Player\" />\n                        <TextInput id=\"password\" v-model=\"form.password\" type=\"password\" class=\"mt-1 w-full\" :placeholder=\"isEditMode ? 'Kosongkan jika tidak ingin diubah' : 'Min. 6 karakter'\" />\n                        <InputError :message=\"form.errors.password\" class=\"mt-2\" />\n                    </div>\n                    <div class=\"md:col-span-2\">\n                        <InputLabel for=\"playlist_id\" value=\"Playlist Musik Latar (Opsional)\" />\n                        <select v-model=\"form.playlist_id\" id=\"playlist_id\" class=\"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm\">\n                            <option value=\"\">-- Tidak Ada Musik Latar --</option>\n                            <option v-for=\"playlist in allPlaylists\" :key=\"playlist.id\" :value=\"playlist.id\">\n                                {{ playlist.name }}\n                            </option>\n                        </select>\n                    </div>\n                    <div class=\"md:col-span-2\">\n                        <InputLabel for=\"schedule_id\" value=\"Schedule (Opsional)\" />\n                        <select v-model=\"form.schedule_id\" id=\"schedule_id\" class=\"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm\">\n                            <option value=\"\">-- Tidak Ada Schedule --</option>\n                            <option v-for=\"schedule in allSchedules\" :key=\"schedule.id\" :value=\"schedule.id\">\n                                {{ schedule.name }}\n                            </option>\n                        </select>\n                    </div>\n                    <div>\n                        <InputLabel for=\"location_name\" value=\"Nama Lokasi\" required />\n                        <TextInput id=\"location_name\" v-model=\"form.location_name\" class=\"mt-1 w-full\" placeholder=\"Cth: Mall Grand Indonesia\" />\n                        <InputError :message=\"form.errors.location_name\" class=\"mt-2\" />\n                    </div>\n                    <div>\n                        <InputLabel for=\"latitude\" value=\"Latitude (Opsional)\" />\n                        <TextInput id=\"latitude\" v-model=\"form.latitude\" type=\"number\" step=\"any\" class=\"mt-1 w-full\" placeholder=\"Cth: -6.2013\" />\n                        <InputError :message=\"form.errors.latitude\" class=\"mt-2\" />\n                    </div>\n                    <div>\n                        <InputLabel for=\"longitude\" value=\"Longitude (Opsional)\" />\n                        <TextInput id=\"longitude\" v-model=\"form.longitude\" type=\"number\" step=\"any\" class=\"mt-1 w-full\" placeholder=\"Cth: 106.8225\" />\n                        <InputError :message=\"form.errors.longitude\" class=\"mt-2\" />\n                    </div>\n                    <div>\n                        <InputLabel for=\"resolution\" value=\"Resolusi (Opsional)\" />\n                        <TextInput id=\"resolution\" v-model=\"form.resolution\" class=\"mt-1 w-full\" placeholder=\"Cth: 1920x1080\" />\n                        <InputError :message=\"form.errors.resolution\" class=\"mt-2\" />\n                    </div>\n                    <div>\n                        <InputLabel for=\"status\" value=\"Status\" required />\n                        <select v-model=\"form.status\" id=\"status\" class=\"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm\">\n                            <option value=\"active\">Active</option>\n                            <option value=\"inactive\">Inactive</option>\n                            <option value=\"maintenance\">Maintenance</option>\n                        </select>\n                        <InputError :message=\"form.errors.status\" class=\"mt-2\" />\n                    </div>\n                </div>\n                <div class=\"mt-6 flex justify-end space-x-3 border-t border-gray-200 dark:border-gray-700 pt-6\">\n                    <SecondaryButton @click=\"closeModal\">Batal</SecondaryButton>\n                    <PrimaryButton :disabled=\"form.processing\" :class=\"{ 'opacity-25': form.processing }\">{{ isEditMode ? 'Update' : 'Simpan' }}</PrimaryButton>\n                </div>\n            </form>\n        </Modal>\n\n        <Modal :show=\"showDeleteConfirmModal\" @close=\"showDeleteConfirmModal = false\" maxWidth=\"md\">\n            <div class=\"p-6\">\n                <h2 class=\"text-lg font-medium text-gray-900 dark:text-gray-100\">Konfirmasi Hapus</h2>\n                <p class=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">Yakin ingin menghapus videotron \"{{ videotronToDelete?.name }}\"?</p>\n                <div class=\"mt-6 flex justify-end\">\n                    <SecondaryButton @click=\"showDeleteConfirmModal = false\">Batal</SecondaryButton>\n                    <DangerButton @click=\"deleteVideotron\" class=\"ml-3\">Ya, Hapus</DangerButton>\n                </div>\n            </div>\n        </Modal>\n    </AuthenticatedLayout>\n</template>\n"
        }
    ]
}